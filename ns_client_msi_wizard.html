<!-- 
  Netskope Client MSI Parameter Wizard
  Version: 1.11
  Author: Peter Hayes
  Disclaimer: This tool is not affiliated with or supported by Netskope. Use at your own risk.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Netskope Client MSI Parameter Wizard</title>
  <!-- Bootstrap 5 CDN -->
  <link 
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous">

  <style>
    /* Page layout */
    body { 
      margin: 0 auto; 
      width: 900px; 
    }

    h1 { 
      text-align: center; 
    }

    /* Label styles */
    label.title { 
      font-weight: bold; 
      font-size: 18px; 
    }

    .form-check-label { 
      font-weight: bold; 
      color: #000; 
    }

    /* Command output terminal styling */
    .command-output {
      font-family: "Courier New", Courier, monospace;
      background-color: #000;
      color: #33ff33;
      padding: 10px 30px;
      position: relative;
      margin-bottom: 10px;
      min-height: 60px;
      white-space: pre-line;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .command-output code {
      color: inherit;
      font-size: 1rem;
      display: block;
      line-height: 1.4;
      padding: 10px 0;
    }

    .output-placeholder {
      color: #888;
      font-style: italic;
    }

    /* Copy/Download button styling */
    .action-button {
      background-color: #111; 
      color: #33ff33;
      border: 1px solid #33ff33;
      border-radius: 3px;
      font-size: 0.8rem;
      padding: 2px 8px;
      cursor: pointer;
      display: none;
      text-decoration: none;
    }

    .action-button:hover {
      background-color: #33ff33;
      color: #000;
    }

    .action-button:focus {
      outline: none;
    }

    /* Extra small text */
    .text-xs {
      font-size: 60%;
    }

    /* Highlight pending required fields with border */
    .pending-input {
      border: 1px solid #ffc107 !important;
      box-shadow: 0 0 5px rgba(255, 193, 7, 0.6);
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="text-center">
      <h1>Netskope Client MSI Parameter Wizard</h1>
    </div>

    <form>
      <div class="container pt-2">

        <!-- Windows Netskope Client Documentation link -->
        <div class="text-center small mb-3">
          <a href="https://docs.netskope.com/en/netskope-client-for-windows.html">
            Netskope Client For Windows Documentation
          </a>
        </div>

        <!-- Row 1: Tenant + Domain / Client Enrollment Mode -->
        <div class="row g-3">
          <!-- Field Set #1: Tenant + Domain -->
          <div class="col-md-6">
            <div class="border bg-light p-3 h-100">
              <div class="mb-2">
                <label for="tenant" class="title">Tenant</label>
                <input type="text" class="form-control" id="tenant" placeholder="Enter your tenant host" />
                <span class="small pt-1 ps-1 d-block">
                  Enter only the bolded host, <b>tenant</b>.goskope.com
                </span>
              </div>
              <div>
                <label for="domain" class="title">Domain</label>
                <select class="form-select" id="domain" disabled>
                  <option value="goskope.com">goskope.com</option>
                  <option value="eu.goskope.com">eu.goskope.com</option>
                  <option value="de.goskope.com">de.goskope.com</option>
                  <option value="au.goskope.com">au.goskope.com</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Field Set #2: Client Enrollment Mode -->
          <div class="col-md-6">
            <div class="border bg-light p-3 h-100">
              <div class="mb-2">
                <label for="userMode" class="title">Client Enrollment Mode</label>
                <select class="form-select" id="userMode" size="4" disabled>
                  <option value="single-upn">UPN Enrollment - Single User</option>
                  <option value="multi-upn">UPN Enrollment - Multi-User</option>
                  <option value="single-idp">IdP Enrollment - Single User</option>
                  <option value="multi-idp">IdP Enrollment - Multi-User</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 2: Tokens + Prelogon/Fail-Closed/Log File Path -->
        <div class="row g-3 mt-2">
          <!-- Field Set #3: Tokens -->
          <div class="col-md-6">
            <div class="border bg-light p-3 h-100">
              <div class="mb-2">
                <label for="token" class="title">Organization ID Token</label>
                <input type="text" class="form-control" id="token" placeholder="Enter the organization ID token" disabled />
              </div>
              <div class="mb-2">
                <label for="enrollauthtoken" class="title">Authentication Token</label>
                <input type="text" class="form-control" id="enrollauthtoken" placeholder="Enter authentication token" disabled />
              </div>
              <div>
                <label for="enrollencryptiontoken" class="title">Encryption Token</label>
                <input type="text" class="form-control" id="enrollencryptiontoken" placeholder="Enter encryption token" disabled />
              </div>
            </div>
          </div>

          <!-- Field Set #4: Prelogon + Fail-Closed + Log File Path -->
          <div class="col-md-6">
            <div class="border bg-light p-3 h-100">
              <div class="mb-2">
                <label for="prelogon-user" class="title">Prelogon User</label>
                <label class="text-xs">Optional</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="prelogon-user" placeholder="user-id" disabled />
                  <span class="input-group-text">@prelogon.netskope.com</span>
                </div>
              </div>
              <div class="mb-2">
                <label for="failClosed" class="title">Fail-Closed Action</label>
                <label class="text-xs">Optional</label>
                <select class="form-select" id="failClosed" disabled>
                  <option value="" disabled selected>--Select Failover Mode--</option>
                  <option value="disable">Disabled</option>
                  <option value="no-npa">SWG/CASB (not NPA)</option>
                </select>
              </div>
              <div>
                <label for="log-file-path" class="title">Log File Path</label>
                <label class="text-xs">Optional</label>
                <input type="text" class="form-control" id="log-file-path" placeholder="e.g., %PUBLIC%\nscinstall.log" disabled />
              </div>
            </div>
          </div>
        </div>

        <!-- Row 3: Checkboxes -->
        <div class="row g-3 mt-2">
          <div class="col-12">
            <div class="border bg-light p-3">
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <input type="checkbox" class="form-check-input" id="autoUpdate" disabled />
                  <label class="form-check-label" for="autoUpdate">Auto-Update</label>
                </div>
                <div class="col-md-4">
                  <input type="checkbox" class="form-check-input" id="silentInstall" disabled checked />
                  <label class="form-check-label" for="silentInstall">Silent Install</label>
                </div>
                <div class="col-md-4">
                  <input type="checkbox" class="form-check-input" id="npavdimode" disabled />
                  <label class="form-check-label" for="npavdimode">NPA VDI Mode</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Command output -->
        <div class="container mt-4 p-0">
          <div class="command-output">
            <code id="command" class="output-placeholder"></code>
          </div>
          <div class="text-end mt-2 mb-4">
            <button class="action-button" id="copyButton" type="button" disabled>
              Copy
            </button>
            <a class="action-button" id="downloadButton" href="#" target="_blank">
              Download Client
            </a>
          </div>
        </div>

      </div>
    </form>
  </div>
  
  <!-- Disclaimer footer -->
  <footer class="text-center mt-2 mb-3">
    <small class="text-muted">
      This tool is not affiliated with or supported by Netskope. Use at your own risk.
    </small>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tenantInput = document.getElementById('tenant');
      const allOtherFields = document.querySelectorAll('input:not(#tenant), select, button#copyButton');
      const cmdOutput = document.getElementById('command');
      const copyButton = document.getElementById('copyButton');
      const downloadButton = document.getElementById('downloadButton');

      // IDs of optional fields (exclude from highlighting)
      const optionalFields = ['prelogon-user', 'failClosed', 'log-file-path', 'enrollencryptiontoken'];

      function setFieldsEnabled(enabled) {
        allOtherFields.forEach(el => el.disabled = !enabled);
      }
      setFieldsEnabled(false);

      tenantInput.addEventListener('input', () => {
        const hasValue = tenantInput.value.trim().length > 0;
        setFieldsEnabled(hasValue);
        update();
      });

      let npavdiInteracted = false;
      document.getElementById('npavdimode').addEventListener('change', () => {
        npavdiInteracted = true;
        update();
      });

      const parameterMap = {
        tenant: val => {
          const mode = document.getElementById('userMode').value;
          return (mode.includes('idp') && val) ? `tenant=${val}` : '';
        },
        domain: val => {
          const mode = document.getElementById('userMode').value;
          return (mode.includes('idp') && val) ? `domain=${val}` : '';
        },
        token: val => val ? `token=${val}` : '',
        enrollauthtoken: val => val ? `enrollauthtoken=${val}` : '',
        enrollencryptiontoken: val => val ? `enrollencryptiontoken=${val}` : '',
        'prelogon-user': val => val ? `prelogonuser=${val}@prelogon.netskope.com` : '',
        failClosed: val => val ? `fail-close=${val}` : '',
        autoUpdate: val => `autoupdate=${val ? 'on' : 'off'}`,
        npavdimode: val => (npavdiInteracted ? `npavdimode=${val ? 'on' : 'off'}` : ''),
        silentInstall: val => val ? '/qn' : '',
        'log-file-path': val => val ? `/l*v \"${val}\"` : '',
        userMode: val => ({
          'single-upn': '',
          'single-idp': 'installmode=IDP',
          'multi-upn': 'mode=peruserconfig',
          'multi-idp': 'mode=peruserconfig installmode=IDP'
        }[val] || '')
      };

      function buildCommand() {
        let parts = [];
        let ending = [];

        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(el => {
          const id = el.id;
          let val = (el.type === 'checkbox') ? el.checked : el.value;
          if (parameterMap[id]) {
            const param = parameterMap[id](val);

            if (id === "autoUpdate" || id === "silentInstall") {
              if (param) ending.push(param);
            } else {
              if (param) parts.push(param);
            }
          }
        });

		const tenant = document.getElementById('tenant').value;
		const domain = document.getElementById('domain').value;
		const userMode = document.getElementById('userMode').value;

		// Only add host parameter if not using IdP mode
		if (tenant && domain && !userMode.includes('idp')) {
			parts.push(`host=addon-${tenant}.${domain}`);
		}

        return `msiexec /I NSClient.msi ${parts.join(' ')} ${ending.join(' ')}`.trim();
      }

      function highlightPendingFields() {
        const tenant = tenantInput.value.trim();
        const inputs = document.querySelectorAll('input:not(#tenant), select');

        inputs.forEach(el => {
          if (el.disabled || optionalFields.includes(el.id)) {
            el.classList.remove('pending-input');
            return;
          }

          let isEmpty = false;
          if (el.type === 'checkbox') {
            isEmpty = false; // skip checkboxes
          } else if (el.tagName === 'SELECT') {
            isEmpty = !el.value;
          } else {
            isEmpty = !el.value.trim();
          }

          if (tenant && isEmpty) {
            el.classList.add('pending-input');
          } else {
            el.classList.remove('pending-input');
          }
        });
      }

      function update() {
        const tenant = tenantInput.value.trim();
        const domain = document.getElementById('domain').value;
        const userMode = document.getElementById('userMode').value;
        const token = document.getElementById('token').value.trim();
        const enrollToken = document.getElementById('enrollauthtoken').value.trim();

        if (!tenant) {
          cmdOutput.textContent = '';
          copyButton.disabled = true;
          copyButton.style.display = "none";
          downloadButton.style.display = "none";
          highlightPendingFields();
          return;
        }

        let missing = [];
        if (!userMode || !token || !enrollToken) missing.push("Almost there! Please provide the following:");
        if (!userMode) missing.push("- Select an Enrollment Mode");
        if (!token) missing.push("- Enter a Tenant Token");
        if (!enrollToken) missing.push("- Enter an Enrollment Token");

        if (missing.length > 0) {
          cmdOutput.textContent = missing.join("\n");
          cmdOutput.classList.add("output-placeholder");
          copyButton.disabled = true;
          copyButton.style.display = "none";
          downloadButton.style.display = "none";
          highlightPendingFields();
          return;
        }

        const cmd = buildCommand();
        cmdOutput.textContent = cmd;
        cmdOutput.classList.remove("output-placeholder");
        copyButton.disabled = !cmd;
        copyButton.style.display = cmd ? "inline-block" : "none";

        // Build download URL
        if (tenant && domain) {
          const downloadUrl = `https://download-${tenant}.${domain}/dlr/win/get`;
          downloadButton.href = downloadUrl;
          downloadButton.style.display = cmd ? "inline-block" : "none";
        } else {
          downloadButton.style.display = "none";
        }

        highlightPendingFields();
      }

      document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', update);
        el.addEventListener('change', update);
      });

      copyButton.addEventListener('click', () => {
        const cmd = cmdOutput.textContent;
        if (cmd && !cmdOutput.classList.contains("placeholder")) {
          navigator.clipboard.writeText(cmd);
        }
      });

      update();
    });
  </script>
</body>
</html>
